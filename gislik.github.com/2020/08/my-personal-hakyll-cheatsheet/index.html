<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns#">
    <head>
        <meta charset="utf-8" />
        <meta name="referrer" content="no-referrer">

        <!-- Enable responsiveness on mobile devices-->
        <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" /> -->
        <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

        <title>Gisli | My personal Hakyll cheatsheet</title>

        <!-- Google Tag Manager -->
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-W95TH5W');</script>
        <!-- End Google Tag Manager -->

        <meta property="og:title" content="Gísli | My personal Hakyll cheatsheet" />
        <meta property="og:description" content="My thoughts on blockchains and software" />
        <meta name="description" content="My thoughts on blockchains and software" />
        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@gislik" />
        <meta name="twitter:image" content="https://gisli.hamstur.is/img/2020/hakyll-twitter-card.png" />
        <meta property="og:site_name" content="Gísli | My personal Hakyll cheatsheet" />
        <meta property="og:url" content="https://gisli.hamstur.is/2020/08/my-personal-hakyll-cheatsheet/" />

        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="../../../css/base.css" />
        <link rel="stylesheet" href="../../../css/custom.css" />
        <link rel="stylesheet" href="../../../css/syntax/kate.css" />
        <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro&family=Rock+Salt&display=swap" rel="stylesheet">
        <link href="../../../css/fontawesome/fontawesome.css" rel="stylesheet">
        <link href="../../../css/fontawesome/brands.css" rel="stylesheet">
        <link href="../../../css/fontawesome/solid.css" rel="stylesheet">

        <link rel="icon" type="image/x-icon" href="../../../icon48x48.png" />
        <link rel="apple-touch-icon" sizes="48x48" href="../../../icon48x48.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="../../../icon72x72.png" />
        <link rel="apple-touch-icon" sizes="96x96" href="../../../icon96x96.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="../../../icon144x144.png" />
        <link rel="apple-touch-icon" sizes="192x192" href="../../../icon192x192.png" />
        <!-- <link rel="apple-touch-icon" sizes="256x256" href="" /> -->
        <!-- <link rel="apple-touch-icon" sizes="384x384" href="" /> -->
        <!-- <link rel="apple-touch-icon" sizes="512x512" href="" /> -->

        <link rel="alternate" type="application/atom+xml" title="My personal Hakyll cheatsheet" href="../../../atom.xml">
    </head>
    <body>
        <!-- Google Tag Manager (noscript) -->
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-W95TH5W" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
        <!-- End Google Tag Manager (noscript) -->
        <a href="./#main" class="skip-link p-screen-reader-text">Skip to content</a>
        <header class="profile">
            <a class="profile-icon" href="../../../">
                <img src="../../../icon72x72.png" alt="profile picture">
            </a>
            <nav class="header">
                <a href="../../../about/">About</a>
                <a href="../../../decks/">Decks</a>
            </nav>
        </header>

        <main id="main" class="l-main">
        <article class="p-article">

    <header>
        <h2 class="c-title c-article__title">My personal Hakyll cheatsheet</h2>
        <p class="c-article__meta">
            <time datetime="August 20, 2020">August 20, 2020</time>
        </p>
        <p class="c-article__meta">
            13 min read
        </p>
    </header>

    <section id="js-article" class="c-article__body">
        <div class="toc"><ul>
<li><a href="./#hakyll-heart-pandoc"><span class="toc-section-number">1</span> Hakyll ❤ Pandoc</a></li>
<li><a href="./#website-rules"><span class="toc-section-number">2</span> Website rules</a><ul>
<li><a href="./#matching-clause-routes-and-compilers"><span class="toc-section-number">2.1</span> Matching clause, routes and compilers</a></li>
<li><a href="./#templates-and-their-contexts"><span class="toc-section-number">2.2</span> Templates and their contexts</a></li>
<li><a href="./#metadata-flow-control-and-list-iteration"><span class="toc-section-number">2.3</span> Metadata, flow control and list iteration</a></li>
</ul></li>
<li><a href="./#advanced-features"><span class="toc-section-number">3</span> Advanced features</a><ul>
<li><a href="./#auto-generated-table-of-contents"><span class="toc-section-number">3.1</span> Auto-generated table of contents</a></li>
<li><a href="./#katex-to-render-latex-math"><span class="toc-section-number">3.2</span> <span class="math inline">\(\KaTeX\ \)</span> to render <span class="math inline">\(\LaTeX\)</span> math</a></li>
<li><a href="./#decks-and-presentations"><span class="toc-section-number">3.3</span> Decks and presentations</a></li>
<li><a href="./#paginating-posts"><span class="toc-section-number">3.4</span> Paginating posts</a></li>
<li><a href="./#support-for-tags-and-categories"><span class="toc-section-number">3.5</span> Support for tags and categories</a></li>
</ul></li>
<li><a href="./#rolling-your-own"><span class="toc-section-number">4</span> Rolling your own</a><ul>
<li><a href="./#collecting-rules-in-the-rules-monad"><span class="toc-section-number">4.1</span> Collecting rules in the Rules monad</a></li>
<li><a href="./#identifiers-and-patterns"><span class="toc-section-number">4.2</span> Identifiers and patterns</a></li>
<li><a href="./#writing-compilers-and-loading-items"><span class="toc-section-number">4.3</span> Writing Compilers and loading Items</a></li>
<li><a href="./#snapshots-to-define-a-pipeline-stage"><span class="toc-section-number">4.4</span> Snapshots to define a pipeline stage</a></li>
<li><a href="./#working-with-contexts-and-templates"><span class="toc-section-number">4.5</span> Working with contexts and templates</a></li>
</ul></li>
</ul></div><h1 id="hakyll-heart-pandoc"><span class="header-section-number">1</span> Hakyll ❤ Pandoc</h1>
<p>Since I don’t write Haskell code professionally anymore it takes me longer to get into the right rhythm. This post is intended for my future self more or less and should serve as a cheatsheet for Hakyll development. I’ve already written a high level overview of how to edit content and build the website in this <a href="https://github.com/gislik/gisli.hamstur.is/blob/master/README.md">README</a>. Here I want to go deeper into how to construct new compilers and how to apply them in a context to templates.</p>
<p>Under the hood Hakyll integrates natively with <a href="http://johnmacfarlane.net/pandoc/">Pandoc</a> – the swiss-army knife of file converters. Pandoc is also written in Haskell and can convert files between a wide variety of file formats and can be extended with custom <a href="http://www.lua.org/">Lua</a> filters. All this has some configuration complexities associated with it and below I also discuss the various configurations and extensions used to enable the auto-generation of table of contents and <span class="math inline">\(\LaTeX\)</span> math support on this website.</p>
<h1 id="website-rules"><span class="header-section-number">2</span> Website rules</h1>
<h2 id="matching-clause-routes-and-compilers"><span class="header-section-number">2.1</span> Matching clause, routes and compilers</h2>
<p>Writing rules in the DSL<a href="./#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> is simple enough. A rule needs three things to be valid; a matching clause for the source file, a route for the compiled output and the compiler itself which is responsible for the transformation between the input and the output.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb1-1"><a href="./#cb1-1"></a><span class="co">-- static css</span></span>
<span id="cb1-2"><a href="./#cb1-2"></a>match <span class="st">&quot;css/**.css&quot;</span> <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb1-3"><a href="./#cb1-3"></a>   route   <span class="op">$</span> idRoute</span>
<span id="cb1-4"><a href="./#cb1-4"></a>   compile <span class="op">$</span> compressCssCompiler</span></code></pre></div>
<p>We match all files with the <code>.css</code> extension in the <code>css</code> directory and its subdirectories (had we used * only files in the <code>css</code> directory would match). The <code>idRoute</code> preserves the filename as is but other routes may change the e.g. the extension or something more complex. For example we want to match files with <code>.scss</code> extension, compile them and pipe the compressed results to a file with the <code>.css</code> extension for browser compatibility.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="./#cb2-1"></a>match (<span class="st">&quot;css/**.scss&quot;</span> <span class="op">.&amp;&amp;.</span> complement <span class="st">&quot;css/**_*.scss&quot;</span>) <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb2-2"><a href="./#cb2-2"></a>   route   <span class="op">$</span> setExtension <span class="st">&quot;css&quot;</span></span>
<span id="cb2-3"><a href="./#cb2-3"></a>   compile <span class="op">$</span> sassCompiler</span>
<span id="cb2-4"><a href="./#cb2-4"></a>      <span class="op">&gt;&gt;=</span> <span class="fu">return</span> <span class="op">.</span> <span class="fu">fmap</span> compressCss</span></code></pre></div>
<p>In some cases instead of a source file to match we just create an output directly. This is the case with <code>index.html</code> which is dynamically generated from from the latest blog posts.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="./#cb3-1"></a><span class="co">-- index</span></span>
<span id="cb3-2"><a href="./#cb3-2"></a>create [<span class="st">&quot;index.html&quot;</span>] <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb3-3"><a href="./#cb3-3"></a>   route   <span class="op">$</span> idRoute</span>
<span id="cb3-4"><a href="./#cb3-4"></a>   compile <span class="op">$</span> makeItem <span class="st">&quot;&quot;</span></span>
<span id="cb3-5"><a href="./#cb3-5"></a>      <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/blog-list.html&quot;</span> (blogCtx <span class="dv">1</span> pages categories tags)</span>
<span id="cb3-6"><a href="./#cb3-6"></a>      <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> defaultCtx </span>
<span id="cb3-7"><a href="./#cb3-7"></a>      <span class="op">&gt;&gt;=</span> indexCompiler</span>
<span id="cb3-8"><a href="./#cb3-8"></a>      <span class="op">&gt;&gt;=</span> relativizeUrls</span></code></pre></div>
<h2 id="templates-and-their-contexts"><span class="header-section-number">2.2</span> Templates and their contexts</h2>
<p>Optionally the compiler may load a template to the input and interpolate variables from a context. We do so by chaining multiple compilers together into a more feature rich compiler. The output of a previous compiler is interpolated into the $body$ variable of the template. Other variables are made available to the template by defining them in the context. Before templates can be loaded they need to be compiled using the <code>templateCompiler</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="./#cb4-1"></a><span class="co">-- static pages</span></span>
<span id="cb4-2"><a href="./#cb4-2"></a>match <span class="st">&quot;*.md&quot;</span> <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb4-3"><a href="./#cb4-3"></a>   route   <span class="op">$</span> pageRoute</span>
<span id="cb4-4"><a href="./#cb4-4"></a>   compile <span class="op">$</span> pandocCompiler</span>
<span id="cb4-5"><a href="./#cb4-5"></a>      <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/page-detail.html&quot;</span> defaultCtx</span>
<span id="cb4-6"><a href="./#cb4-6"></a>      <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> defaultCtx</span>
<span id="cb4-7"><a href="./#cb4-7"></a>      <span class="op">&gt;&gt;=</span> relativizeUrls</span>
<span id="cb4-8"><a href="./#cb4-8"></a></span>
<span id="cb4-9"><a href="./#cb4-9"></a><span class="co">-- templates</span></span>
<span id="cb4-10"><a href="./#cb4-10"></a>match <span class="st">&quot;templates/*.html&quot;</span> <span class="op">$</span>  <span class="co">-- note that the order does not matter</span></span>
<span id="cb4-11"><a href="./#cb4-11"></a>   compile <span class="op">$</span> templateCompiler</span></code></pre></div>
<p>Contexts are monoids and can therefore be easily combined to create bigger contexts where the earlier definition of a non-empty (<code>mempty</code>) field takes precedence.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="./#cb5-1"></a><span class="ot">pageTitleField ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Context</span> <span class="dt">String</span></span>
<span id="cb5-2"><a href="./#cb5-2"></a>pageTitleField key <span class="ot">=</span> </span>
<span id="cb5-3"><a href="./#cb5-3"></a>   aliasContext alias metadataField <span class="op">&lt;&gt;</span> <span class="co">-- use page title from metadata</span></span>
<span id="cb5-4"><a href="./#cb5-4"></a>   pathTitleField key               <span class="op">&lt;&gt;</span> <span class="co">-- or read from the path</span></span>
<span id="cb5-5"><a href="./#cb5-5"></a>   constField key <span class="st">&quot;Crypto and Code&quot;</span>    <span class="co">-- alternatively use this</span></span>
<span id="cb5-6"><a href="./#cb5-6"></a>   <span class="kw">where</span></span>
<span id="cb5-7"><a href="./#cb5-7"></a>      alias x <span class="op">|</span> x <span class="op">==</span> key <span class="ot">=</span> <span class="st">&quot;title&quot;</span></span>
<span id="cb5-8"><a href="./#cb5-8"></a>      alias x            <span class="ot">=</span> x</span></code></pre></div>
<p>A special case of the string context is the function context which defines a variable which value is a function which can be called in the template.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb6-1"><a href="./#cb6-1"></a><span class="kw">&lt;header&gt;</span></span>
<span id="cb6-2"><a href="./#cb6-2"></a>  $partial(&quot;templates/header.html&quot;)$</span>
<span id="cb6-3"><a href="./#cb6-3"></a><span class="kw">&lt;/header&gt;</span></span>
<span id="cb6-4"><a href="./#cb6-4"></a></span>
<span id="cb6-5"><a href="./#cb6-5"></a><span class="kw">&lt;p&gt;</span></span>
<span id="cb6-6"><a href="./#cb6-6"></a>  $countwords(body)$</span>
<span id="cb6-7"><a href="./#cb6-7"></a>  $sum(1,2,3)$</span>
<span id="cb6-8"><a href="./#cb6-8"></a><span class="kw">&lt;/p&gt;</span></span></code></pre></div>
<h2 id="metadata-flow-control-and-list-iteration"><span class="header-section-number">2.3</span> Metadata, flow control and list iteration</h2>
<p>Metadata can be placed in the front matter of the markdown formatted as <a href="https://yaml.org/">YAML</a>. The metadata can be made available both to the compiler and to the template in case the <code>metadataField :: Context a</code> is applied to the template. Tags can eiter be comma separated or as a valid YAML list.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb7-1"><a href="./#cb7-1"></a>---</span>
<span id="cb7-2"><a href="./#cb7-2"></a>title: This is the blog title</span>
<span id="cb7-3"><a href="./#cb7-3"></a>tags: tag1, tag2</span>
<span id="cb7-4"><a href="./#cb7-4"></a>tags: </span>
<span id="cb7-5"><a href="./#cb7-5"></a>   - tag1</span>
<span id="cb7-6"><a href="./#cb7-6"></a>   - tag2</span>
<span id="cb7-7"><a href="./#cb7-7"></a>summary: |</span>
<span id="cb7-8"><a href="./#cb7-8"></a>  Introduction to the blog content</span>
<span id="cb7-9"><a href="./#cb7-9"></a>---</span>
<span id="cb7-10"><a href="./#cb7-10"></a></span>
<span id="cb7-11"><a href="./#cb7-11"></a>This is the blog body</span></code></pre></div>
<p>Special function variables are used to define conditional branches to display and iterate over items. The variable names used within the $for(blogs)$ loop are defined in the <code>blog</code> list field. Everything between $sep$ and $endfor$ will be used as a separator between items, i.e. it is not included for the last element.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb8-1"><a href="./#cb8-1"></a><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;blog-list&quot;</span><span class="kw">&gt;</span></span>
<span id="cb8-2"><a href="./#cb8-2"></a>$for(blogs)$</span>
<span id="cb8-3"><a href="./#cb8-3"></a>  <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;blog-item&quot;</span><span class="kw">&gt;</span></span>
<span id="cb8-4"><a href="./#cb8-4"></a>    $title$</span>
<span id="cb8-5"><a href="./#cb8-5"></a>  $if(blog.author)$</span>
<span id="cb8-6"><a href="./#cb8-6"></a>    $blog.author$</span>
<span id="cb8-7"><a href="./#cb8-7"></a>  $else$ </span>
<span id="cb8-8"><a href="./#cb8-8"></a>    Unknown author</span>
<span id="cb8-9"><a href="./#cb8-9"></a>  $endif$</span>
<span id="cb8-10"><a href="./#cb8-10"></a>  <span class="kw">&lt;gdiv&gt;</span></span>
<span id="cb8-11"><a href="./#cb8-11"></a>  $sep$</span>
<span id="cb8-12"><a href="./#cb8-12"></a>  <span class="kw">&lt;hr</span><span class="ot"> g</span><span class="kw">&gt;</span></span>
<span id="cb8-13"><a href="./#cb8-13"></a>$endfor$</span>
<span id="cb8-14"><a href="./#cb8-14"></a><span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<h1 id="advanced-features"><span class="header-section-number">3</span> Advanced features</h1>
<p>Using the <code>pandocCompilerWith</code> some options can be passed in which affect the behavior of Pandoc. In addition extensions can be enabled which unlock additional features.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb9-1"><a href="./#cb9-1"></a><span class="ot">pandocCompilerWith ::</span> <span class="dt">ReaderOptions</span> <span class="ot">-&gt;</span> <span class="dt">WriterOptions</span> <span class="ot">-&gt;</span> <span class="dt">Compiler</span> (<span class="dt">Item</span> <span class="dt">String</span>)</span>
<span id="cb9-2"><a href="./#cb9-2"></a></span>
<span id="cb9-3"><a href="./#cb9-3"></a><span class="ot">blogCompiler ::</span> <span class="dt">Compiler</span> (<span class="dt">Item</span> <span class="dt">String</span>)</span>
<span id="cb9-4"><a href="./#cb9-4"></a>blogCompiler <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb9-5"><a href="./#cb9-5"></a>   ident <span class="ot">&lt;-</span> getUnderlying</span>
<span id="cb9-6"><a href="./#cb9-6"></a>   toc   <span class="ot">&lt;-</span> getMetadataField ident <span class="st">&quot;withtoc&quot;</span></span>
<span id="cb9-7"><a href="./#cb9-7"></a>   pandocCompilerWith blogReaderOptions (<span class="fu">maybe</span> defaultOptions blogOptions toc)</span>
<span id="cb9-8"><a href="./#cb9-8"></a>   <span class="kw">where</span></span>
<span id="cb9-9"><a href="./#cb9-9"></a>      defaultOptions <span class="ot">=</span> defaultHakyllWriterOptions</span>
<span id="cb9-10"><a href="./#cb9-10"></a>      blogOptions <span class="ot">=</span> <span class="fu">const</span> blogWriterOptions</span></code></pre></div>
<h2 id="auto-generated-table-of-contents"><span class="header-section-number">3.1</span> Auto-generated table of contents</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb10-1"><a href="./#cb10-1"></a><span class="co">-- blogWriterOptions configures pandoc to include a table of contents</span></span>
<span id="cb10-2"><a href="./#cb10-2"></a><span class="co">-- and uses MathJax to render math.</span></span>
<span id="cb10-3"><a href="./#cb10-3"></a><span class="ot">blogWriterOptions ::</span> <span class="dt">WriterOptions</span></span>
<span id="cb10-4"><a href="./#cb10-4"></a>blogWriterOptions <span class="ot">=</span> </span>
<span id="cb10-5"><a href="./#cb10-5"></a>   defaultHakyllWriterOptions</span>
<span id="cb10-6"><a href="./#cb10-6"></a>      {</span>
<span id="cb10-7"><a href="./#cb10-7"></a>        writerHTMLMathMethod <span class="ot">=</span> <span class="dt">MathJax</span> <span class="st">&quot;&quot;</span></span>
<span id="cb10-8"><a href="./#cb10-8"></a>      , writerTableOfContents <span class="ot">=</span> <span class="dt">True</span></span>
<span id="cb10-9"><a href="./#cb10-9"></a>      , writerNumberSections  <span class="ot">=</span> <span class="dt">True</span></span>
<span id="cb10-10"><a href="./#cb10-10"></a>      , writerTOCDepth        <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb10-11"><a href="./#cb10-11"></a>      , writerTemplate        <span class="ot">=</span> </span>
<span id="cb10-12"><a href="./#cb10-12"></a>         <span class="kw">let</span></span>
<span id="cb10-13"><a href="./#cb10-13"></a>            toc <span class="ot">=</span> <span class="st">&quot;$toc$&quot;</span><span class="ot"> ::</span> <span class="dt">String</span></span>
<span id="cb10-14"><a href="./#cb10-14"></a>            body <span class="ot">=</span> <span class="st">&quot;$body$&quot;</span><span class="ot"> ::</span> <span class="dt">String</span></span>
<span id="cb10-15"><a href="./#cb10-15"></a>         <span class="kw">in</span></span>
<span id="cb10-16"><a href="./#cb10-16"></a>            <span class="dt">Just</span> <span class="op">.</span> renderHtml <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb10-17"><a href="./#cb10-17"></a>               H.div <span class="op">!</span> class_ <span class="st">&quot;toc&quot;</span> <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb10-18"><a href="./#cb10-18"></a>                  toHtml toc</span>
<span id="cb10-19"><a href="./#cb10-19"></a>               toHtml body</span>
<span id="cb10-20"><a href="./#cb10-20"></a>      }</span></code></pre></div>
<h2 id="katex-to-render-latex-math"><span class="header-section-number">3.2</span> <span class="math inline">\(\KaTeX\ \)</span> to render <span class="math inline">\(\LaTeX\)</span> math</h2>
<p>Pandoc can transform math to MathJax when configured correctly. KaTeX is able to render the output by embedding the javascript and CSS.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb11-1"><a href="./#cb11-1"></a><span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;/katex/katex.min.css&quot;</span><span class="kw">&gt;</span></span>
<span id="cb11-2"><a href="./#cb11-2"></a><span class="kw">&lt;script</span><span class="ot"> defer src=</span><span class="st">&quot;/katex/katex.min.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb11-3"><a href="./#cb11-3"></a><span class="kw">&lt;script</span><span class="ot"> type=</span><span class="st">&quot;text/javascript&quot;</span><span class="ot"> script defer src=</span><span class="st">&quot;/katex/auto-render.min.js&quot;</span> </span>
<span id="cb11-4"><a href="./#cb11-4"></a><span class="ot">  onload=</span><span class="st">&quot;renderMathInElement(document.body);&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span></code></pre></div>
<p>Equations can be place on their own lines.</p>
<p class="center">
<code class="center">$$ \ln x = \int_{-\infty}^x \frac 1 y \, dy  $$</code>
</p>
<p class="center">
or
</p>
<p class="center">
<code class="center">\[ \ln x = \int_{-\infty}^x \frac 1 y \, dy  \]</code>
</p>
<p class="center">
becomes
</p>
<p><span class="math display">\[ \ln x = \int_{-\infty}^x \frac 1 y \, dy  \]</span></p>
<p>Writing <code>$x \equiv a \pmod{b}$</code> or <code>\( x \equiv a \pmod{b} \)</code> prdouces <span class="math inline">\(x \equiv a \pmod{b}\)</span>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb12-1"><a href="./#cb12-1"></a><span class="ot">blogReaderOptions ::</span> <span class="dt">ReaderOptions</span></span>
<span id="cb12-2"><a href="./#cb12-2"></a>blogReaderOptions <span class="ot">=</span> </span>
<span id="cb12-3"><a href="./#cb12-3"></a>   defaultHakyllReaderOptions</span>
<span id="cb12-4"><a href="./#cb12-4"></a>      {</span>
<span id="cb12-5"><a href="./#cb12-5"></a>         readerExtensions <span class="ot">=</span> </span>
<span id="cb12-6"><a href="./#cb12-6"></a>            (readerExtensions defaultHakyllReaderOptions) <span class="op">&lt;&gt;</span> extensionsFromList</span>
<span id="cb12-7"><a href="./#cb12-7"></a>               [ </span>
<span id="cb12-8"><a href="./#cb12-8"></a>                 <span class="dt">Ext_tex_math_single_backslash</span>  <span class="co">-- TeX math btw (..) [..]</span></span>
<span id="cb12-9"><a href="./#cb12-9"></a>               , <span class="dt">Ext_tex_math_double_backslash</span>  <span class="co">-- TeX math btw \(..\) \[..\]</span></span>
<span id="cb12-10"><a href="./#cb12-10"></a>               , <span class="dt">Ext_tex_math_dollars</span>           <span class="co">-- TeX math between $..$ or $$..$$</span></span>
<span id="cb12-11"><a href="./#cb12-11"></a>               , <span class="dt">Ext_latex_macros</span>               <span class="co">-- Parse LaTeX macro definitions (for math only)</span></span>
<span id="cb12-12"><a href="./#cb12-12"></a>               , <span class="dt">Ext_inline_code_attributes</span>     <span class="co">-- Ext_inline_code_attributes</span></span>
<span id="cb12-13"><a href="./#cb12-13"></a>               , <span class="dt">Ext_abbreviations</span>              <span class="co">-- PHP markdown extra abbreviation definitions</span></span>
<span id="cb12-14"><a href="./#cb12-14"></a>               ]</span>
<span id="cb12-15"><a href="./#cb12-15"></a>      }</span></code></pre></div>
<h2 id="decks-and-presentations"><span class="header-section-number">3.3</span> Decks and presentations</h2>
<p>Gooogle decks can easily be embedded using an HTML snippet and requires no special handling on Hakyll’s side. I wrap the standard <code>&lt;iframe&gt;</code> tag in a <code>div</code> tag with the a special class which makes the presentation responsive.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb13-1"><a href="./#cb13-1"></a><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;responsive&quot;</span><span class="kw">&gt;</span></span>
<span id="cb13-2"><a href="./#cb13-2"></a><span class="kw">&lt;iframe</span><span class="ot"> src=</span><span class="st">&quot;https://docs.google.com/presentation/d/e/</span><span class="er">&lt;</span><span class="st">ID&gt;/embed</span></span>
<span id="cb13-3"><a href="./#cb13-3"></a><span class="st">  ?start=false</span><span class="er">&amp;</span><span class="st">loop=false</span><span class="er">&amp;</span><span class="st">delayms=3000&quot;</span><span class="ot"> frameborder=</span><span class="st">&quot;0&quot;</span><span class="ot"> width=</span><span class="st">&quot;960&quot;</span><span class="ot"> height=</span><span class="st">&quot;569&quot;</span> </span>
<span id="cb13-4"><a href="./#cb13-4"></a><span class="ot">  allowfullscreen=</span><span class="st">&quot;true&quot;</span><span class="ot"> mozallowfullscreen=</span><span class="st">&quot;true&quot;</span><span class="ot"> webkitallowfullscreen=</span><span class="st">&quot;true&quot;</span><span class="kw">&gt;&lt;/iframe&gt;</span></span>
<span id="cb13-5"><a href="./#cb13-5"></a><span class="kw">&lt;/div&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode css"><code class="sourceCode css"><span id="cb14-1"><a href="./#cb14-1"></a><span class="fu">.responsive</span> {</span>
<span id="cb14-2"><a href="./#cb14-2"></a>  <span class="kw">overflow</span>: <span class="dv">hidden</span><span class="op">;</span></span>
<span id="cb14-3"><a href="./#cb14-3"></a>  <span class="kw">padding-bottom</span>:<span class="dv">56.25</span><span class="dt">%</span><span class="op">;</span></span>
<span id="cb14-4"><a href="./#cb14-4"></a>  <span class="kw">position</span>: <span class="dv">relative</span><span class="op">;</span></span>
<span id="cb14-5"><a href="./#cb14-5"></a>  <span class="kw">height</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb14-6"><a href="./#cb14-6"></a>  iframe {</span>
<span id="cb14-7"><a href="./#cb14-7"></a>    <span class="kw">left</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb14-8"><a href="./#cb14-8"></a>    <span class="kw">top</span>: <span class="dv">0</span><span class="op">;</span></span>
<span id="cb14-9"><a href="./#cb14-9"></a>    <span class="kw">height</span>: <span class="dv">100</span><span class="dt">%</span><span class="op">;</span></span>
<span id="cb14-10"><a href="./#cb14-10"></a>    <span class="kw">width</span>: <span class="dv">100</span><span class="dt">%</span><span class="op">;</span></span>
<span id="cb14-11"><a href="./#cb14-11"></a>    <span class="kw">position</span>: <span class="dv">absolute</span><span class="op">;</span></span>
<span id="cb14-12"><a href="./#cb14-12"></a>  }</span>
<span id="cb14-13"><a href="./#cb14-13"></a>}</span></code></pre></div>
<p><a href="https://revealjs.com/">reveal.js</a> – the HTML presentation framework – uses standard HTML tags to define the presentation and supports themes. Enabling reveal.js is achieved by modifying the deck’s base template and adding a few options to the decks metadata.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb15-1"><a href="./#cb15-1"></a>---</span>
<span id="cb15-2"><a href="./#cb15-2"></a>reveal: true</span>
<span id="cb15-3"><a href="./#cb15-3"></a>theme: league</span>
<span id="cb15-4"><a href="./#cb15-4"></a>---</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb16-1"><a href="./#cb16-1"></a><span class="kw">&lt;head&gt;</span></span>
<span id="cb16-2"><a href="./#cb16-2"></a>$if(reveal)$</span>
<span id="cb16-3"><a href="./#cb16-3"></a>  <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;/reveal.js/reset.css&quot;</span><span class="kw">&gt;</span></span>
<span id="cb16-4"><a href="./#cb16-4"></a>  <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;/reveal.js/reveal.css&quot;</span><span class="kw">&gt;</span></span>
<span id="cb16-5"><a href="./#cb16-5"></a>  <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;/reveal.js/theme/$theme$.css&quot;</span><span class="ot"> id=</span><span class="st">&quot;theme&quot;</span><span class="kw">&gt;</span></span>
<span id="cb16-6"><a href="./#cb16-6"></a></span>
<span id="cb16-7"><a href="./#cb16-7"></a>  <span class="co">&lt;!-- Theme used for syntax highlighted code --&gt;</span></span>
<span id="cb16-8"><a href="./#cb16-8"></a>  <span class="kw">&lt;link</span><span class="ot"> rel=</span><span class="st">&quot;stylesheet&quot;</span><span class="ot"> href=</span><span class="st">&quot;/reveal.js/plugin/highlight/monokai.css&quot;</span><span class="ot"> id=</span><span class="st">&quot;highlight-theme&quot;</span><span class="kw">&gt;</span></span>
<span id="cb16-9"><a href="./#cb16-9"></a>$endif$</span>
<span id="cb16-10"><a href="./#cb16-10"></a><span class="kw">&lt;/head&gt;</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb17-1"><a href="./#cb17-1"></a><span class="kw">&lt;body&gt;</span></span>
<span id="cb17-2"><a href="./#cb17-2"></a>  <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;reveal&quot;</span><span class="kw">&gt;</span></span>
<span id="cb17-3"><a href="./#cb17-3"></a>    <span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;slides&quot;</span><span class="kw">&gt;</span></span>
<span id="cb17-4"><a href="./#cb17-4"></a>      $body$</span>
<span id="cb17-5"><a href="./#cb17-5"></a>    <span class="kw">&lt;/div&gt;</span></span>
<span id="cb17-6"><a href="./#cb17-6"></a>  <span class="kw">&lt;/div&gt;</span></span>
<span id="cb17-7"><a href="./#cb17-7"></a></span>
<span id="cb17-8"><a href="./#cb17-8"></a>$if(reveal)$</span>
<span id="cb17-9"><a href="./#cb17-9"></a>  <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;/reveal.js/reveal.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb17-10"><a href="./#cb17-10"></a>  <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;/reveal.js/plugin/notes/notes.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb17-11"><a href="./#cb17-11"></a>  <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;/reveal.js/plugin/markdown/markdown.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb17-12"><a href="./#cb17-12"></a>  <span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;/reveal.js/plugin/highlight/highlight.js&quot;</span><span class="kw">&gt;&lt;/script&gt;</span></span>
<span id="cb17-13"><a href="./#cb17-13"></a>  <span class="kw">&lt;script&gt;</span></span>
<span id="cb17-14"><a href="./#cb17-14"></a>    <span class="co">// More info about initialization &amp; config:</span></span>
<span id="cb17-15"><a href="./#cb17-15"></a>    <span class="co">// - https://revealjs.com/initialization/</span></span>
<span id="cb17-16"><a href="./#cb17-16"></a>    <span class="co">// - https://revealjs.com/config/</span></span>
<span id="cb17-17"><a href="./#cb17-17"></a>    <span class="va">Reveal</span>.<span class="at">initialize</span>(<span class="op">{</span></span>
<span id="cb17-18"><a href="./#cb17-18"></a>      <span class="dt">hash</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb17-19"><a href="./#cb17-19"></a></span>
<span id="cb17-20"><a href="./#cb17-20"></a>      <span class="co">// Learn about plugins: https://revealjs.com/plugins/</span></span>
<span id="cb17-21"><a href="./#cb17-21"></a>      <span class="dt">plugins</span><span class="op">:</span> [ RevealMarkdown<span class="op">,</span> RevealHighlight<span class="op">,</span> RevealNotes ]</span>
<span id="cb17-22"><a href="./#cb17-22"></a>    <span class="op">}</span>)<span class="op">;</span></span>
<span id="cb17-23"><a href="./#cb17-23"></a>		<span class="kw">&lt;/script&gt;</span></span>
<span id="cb17-24"><a href="./#cb17-24"></a>$endif$</span>
<span id="cb17-25"><a href="./#cb17-25"></a><span class="kw">&lt;/body&gt;</span></span></code></pre></div>
<h2 id="paginating-posts"><span class="header-section-number">3.4</span> Paginating posts</h2>
<p>Blog posts are paginated by constructing a <code>Paginate</code> object with <code>buildPaginateWith</code> and then creating rules for every page.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb18-1"><a href="./#cb18-1"></a><span class="kw">type</span> <span class="dt">PageNumber</span> <span class="ot">=</span> <span class="dt">Int</span></span>
<span id="cb18-2"><a href="./#cb18-2"></a></span>
<span id="cb18-3"><a href="./#cb18-3"></a><span class="kw">data</span> <span class="dt">Paginate</span> <span class="ot">=</span> <span class="dt">Paginate</span></span>
<span id="cb18-4"><a href="./#cb18-4"></a>   {<span class="ot"> paginateMap        ::</span> <span class="dt">M.Map</span> <span class="dt">PageNumber</span> [<span class="dt">Identifier</span>] <span class="co">-- used in blogCtx</span></span>
<span id="cb18-5"><a href="./#cb18-5"></a>   ,<span class="ot"> paginateMakeId     ::</span> <span class="dt">PageNumber</span> <span class="ot">-&gt;</span> <span class="dt">Identifier</span> </span>
<span id="cb18-6"><a href="./#cb18-6"></a>   ,<span class="ot"> paginateDependency ::</span> <span class="dt">Dependency</span></span>
<span id="cb18-7"><a href="./#cb18-7"></a>   }</span>
<span id="cb18-8"><a href="./#cb18-8"></a></span>
<span id="cb18-9"><a href="./#cb18-9"></a>buildPaginateWith</span>
<span id="cb18-10"><a href="./#cb18-10"></a><span class="ot">    ::</span> <span class="dt">MonadMetadata</span> m</span>
<span id="cb18-11"><a href="./#cb18-11"></a>    <span class="ot">=&gt;</span> ([<span class="dt">Identifier</span>] <span class="ot">-&gt;</span> m [[<span class="dt">Identifier</span>]])  <span class="co">-- group items into pages</span></span>
<span id="cb18-12"><a href="./#cb18-12"></a>    <span class="ot">-&gt;</span> <span class="dt">Pattern</span>                             <span class="co">-- items to paginate</span></span>
<span id="cb18-13"><a href="./#cb18-13"></a>    <span class="ot">-&gt;</span> (<span class="dt">PageNumber</span> <span class="ot">-&gt;</span> <span class="dt">Identifier</span>)          <span class="co">-- identifiers for the pages</span></span>
<span id="cb18-14"><a href="./#cb18-14"></a>    <span class="ot">-&gt;</span> m <span class="dt">Paginate</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb19-1"><a href="./#cb19-1"></a>hakyll <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb19-2"><a href="./#cb19-2"></a></span>
<span id="cb19-3"><a href="./#cb19-3"></a>   pages <span class="ot">&lt;-</span> buildPages visiblePattern (\i <span class="ot">-&gt;</span> fromCapture <span class="st">&quot;*/index.html&quot;</span> (<span class="fu">show</span> i))</span>
<span id="cb19-4"><a href="./#cb19-4"></a></span>
<span id="cb19-5"><a href="./#cb19-5"></a>   paginateRules pages <span class="op">$</span> \i _ <span class="ot">-&gt;</span> <span class="kw">do</span> <span class="co">-- i is the page number</span></span>
<span id="cb19-6"><a href="./#cb19-6"></a>      route   <span class="op">$</span> idRoute</span>
<span id="cb19-7"><a href="./#cb19-7"></a>      compile <span class="op">$</span> makeItem (<span class="fu">show</span> i)</span>
<span id="cb19-8"><a href="./#cb19-8"></a>         <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/blog-list.html&quot;</span> (blogCtx i pages categories tags)</span>
<span id="cb19-9"><a href="./#cb19-9"></a>         <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> defaultCtx</span>
<span id="cb19-10"><a href="./#cb19-10"></a>         <span class="op">&gt;&gt;=</span> indexCompiler</span>
<span id="cb19-11"><a href="./#cb19-11"></a>         <span class="op">&gt;&gt;=</span> relativizeUrls</span>
<span id="cb19-12"><a href="./#cb19-12"></a></span>
<span id="cb19-13"><a href="./#cb19-13"></a><span class="ot">buildPages ::</span> (<span class="dt">MonadMetadata</span> m, <span class="dt">MonadFail</span> m) </span>
<span id="cb19-14"><a href="./#cb19-14"></a>   <span class="ot">=&gt;</span> <span class="dt">Pattern</span> <span class="ot">-&gt;</span> (<span class="dt">PageNumber</span> <span class="ot">-&gt;</span> <span class="dt">Identifier</span>) <span class="ot">-&gt;</span> m <span class="dt">Paginate</span></span>
<span id="cb19-15"><a href="./#cb19-15"></a>buildPages <span class="kw">pattern</span> makeId <span class="ot">=</span> </span>
<span id="cb19-16"><a href="./#cb19-16"></a>   buildPaginateWith</span>
<span id="cb19-17"><a href="./#cb19-17"></a>      (<span class="fu">return</span> <span class="op">.</span> paginateEvery blogPerPage <span class="op">&lt;=&lt;</span> sortRecentFirst) </span>
<span id="cb19-18"><a href="./#cb19-18"></a>      <span class="kw">pattern</span> </span>
<span id="cb19-19"><a href="./#cb19-19"></a>      makeId</span></code></pre></div>
<p>To access pages pagination links are added to the relevant context. <code>paginateContext</code> returns a default paginate context which provides standard pagination fields but I like to alias those fields to give them a bit more friendly names.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb20-1"><a href="./#cb20-1"></a><span class="co">-- paginateContext returns a default pagin</span></span>
<span id="cb20-2"><a href="./#cb20-2"></a><span class="ot">paginateContext ::</span> <span class="dt">Paginate</span> <span class="ot">-&gt;</span> <span class="dt">PageNumber</span> <span class="ot">-&gt;</span> <span class="dt">Context</span> a</span>
<span id="cb20-3"><a href="./#cb20-3"></a></span>
<span id="cb20-4"><a href="./#cb20-4"></a><span class="ot">blogCtx ::</span> <span class="dt">PageNumber</span> <span class="ot">-&gt;</span> <span class="dt">Paginate</span> <span class="ot">-&gt;</span> <span class="dt">Tags</span> <span class="ot">-&gt;</span> <span class="dt">Tags</span> <span class="ot">-&gt;</span> <span class="dt">Context</span> <span class="dt">String</span></span>
<span id="cb20-5"><a href="./#cb20-5"></a>blogCtx i pages categories tags <span class="ot">=</span> </span>
<span id="cb20-6"><a href="./#cb20-6"></a>      listField <span class="st">&quot;blogs&quot;</span> (blogDetailCtx categories tags) (loadBlogs pat) <span class="op">&lt;&gt;</span></span>
<span id="cb20-7"><a href="./#cb20-7"></a>      categoryListField <span class="st">&quot;categories&quot;</span> categories                         <span class="op">&lt;&gt;</span></span>
<span id="cb20-8"><a href="./#cb20-8"></a>      tagsListField <span class="st">&quot;tags&quot;</span> tags                                         <span class="op">&lt;&gt;</span></span>
<span id="cb20-9"><a href="./#cb20-9"></a>      pagesField i                                                      <span class="op">&lt;&gt;</span> <span class="co">--page links</span></span>
<span id="cb20-10"><a href="./#cb20-10"></a>      defaultCtx</span>
<span id="cb20-11"><a href="./#cb20-11"></a>  <span class="kw">where</span></span>
<span id="cb20-12"><a href="./#cb20-12"></a>      pat <span class="ot">=</span> fromList <span class="op">.</span> fromMaybe [] <span class="op">.</span> M.lookup i <span class="op">.</span> paginateMap <span class="op">$</span> pages</span>
<span id="cb20-13"><a href="./#cb20-13"></a>      pagesField <span class="ot">=</span> aliasContext alias <span class="op">.</span> paginateContext pages <span class="co">-- alias standard fields</span></span>
<span id="cb20-14"><a href="./#cb20-14"></a>      alias <span class="st">&quot;pages.first.number&quot;</span>    <span class="ot">=</span> <span class="st">&quot;firstPageNum&quot;</span></span>
<span id="cb20-15"><a href="./#cb20-15"></a>      alias <span class="st">&quot;pages.first.url&quot;</span>       <span class="ot">=</span> <span class="st">&quot;firstPageUrl&quot;</span></span>
<span id="cb20-16"><a href="./#cb20-16"></a>      alias <span class="st">&quot;pages.next.number&quot;</span>     <span class="ot">=</span> <span class="st">&quot;nextPageNum&quot;</span></span>
<span id="cb20-17"><a href="./#cb20-17"></a>      alias <span class="st">&quot;pages.next.url&quot;</span>        <span class="ot">=</span> <span class="st">&quot;nextPageUrl&quot;</span></span>
<span id="cb20-18"><a href="./#cb20-18"></a>      alias <span class="st">&quot;pages.previous.number&quot;</span> <span class="ot">=</span> <span class="st">&quot;previousPageNum&quot;</span></span>
<span id="cb20-19"><a href="./#cb20-19"></a>      alias <span class="st">&quot;pages.previous.url&quot;</span>    <span class="ot">=</span> <span class="st">&quot;previousPageUrl&quot;</span></span>
<span id="cb20-20"><a href="./#cb20-20"></a>      alias <span class="st">&quot;pages.last.number&quot;</span>     <span class="ot">=</span> <span class="st">&quot;lastPageNum&quot;</span></span>
<span id="cb20-21"><a href="./#cb20-21"></a>      alias <span class="st">&quot;pages.last.url&quot;</span>        <span class="ot">=</span> <span class="st">&quot;lastPageUrl&quot;</span></span>
<span id="cb20-22"><a href="./#cb20-22"></a>      alias <span class="st">&quot;pages.current.number&quot;</span>  <span class="ot">=</span> <span class="st">&quot;currentPageNum&quot;</span></span>
<span id="cb20-23"><a href="./#cb20-23"></a>      alias <span class="st">&quot;pages.count&quot;</span>           <span class="ot">=</span> <span class="st">&quot;numPages&quot;</span></span>
<span id="cb20-24"><a href="./#cb20-24"></a>      alias x                       <span class="ot">=</span> x</span></code></pre></div>
<h2 id="support-for-tags-and-categories"><span class="header-section-number">3.5</span> Support for tags and categories</h2>
<p>Tags are supported in a similar manner to pagination. The <code>Tags</code> object is constructed with either <code>buildTags</code> or <code>buildTagsWith</code>. Hakyll provides <a href="https://www.stackage.org/haddock/lts-16.10/hakyll-4.13.4.0/Hakyll-Web-Tags.html">functions</a> to sort tags, render them and adding to a context. Rules for each tag must be created <code>using tagsRules</code> in order for tags to work.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb21-1"><a href="./#cb21-1"></a><span class="kw">data</span> <span class="dt">Tags</span> <span class="ot">=</span> <span class="dt">Tags</span></span>
<span id="cb21-2"><a href="./#cb21-2"></a>   {<span class="ot"> tagsMap        ::</span> [(<span class="dt">String</span>, [<span class="dt">Identifier</span>])]</span>
<span id="cb21-3"><a href="./#cb21-3"></a>   ,<span class="ot"> tagsMakeId     ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Identifier</span></span>
<span id="cb21-4"><a href="./#cb21-4"></a>   ,<span class="ot"> tagsDependency ::</span> <span class="dt">Dependency</span></span>
<span id="cb21-5"><a href="./#cb21-5"></a>   }</span>
<span id="cb21-6"><a href="./#cb21-6"></a></span>
<span id="cb21-7"><a href="./#cb21-7"></a><span class="co">-- buildTags takes a pattern for loading resources and </span></span>
<span id="cb21-8"><a href="./#cb21-8"></a><span class="co">-- a mapping from the tag name to its identifier</span></span>
<span id="cb21-9"><a href="./#cb21-9"></a><span class="ot">buildTags ::</span> <span class="dt">MonadMetadata</span> m <span class="ot">=&gt;</span> <span class="dt">Pattern</span> <span class="ot">-&gt;</span> (<span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Identifier</span>) <span class="ot">-&gt;</span> m <span class="dt">Tags</span></span>
<span id="cb21-10"><a href="./#cb21-10"></a></span>
<span id="cb21-11"><a href="./#cb21-11"></a><span class="co">-- getTags returns the tag field from the metadata as a list of strings</span></span>
<span id="cb21-12"><a href="./#cb21-12"></a><span class="co">-- the field value can either be tags separated by a comma or a valid YAML list</span></span>
<span id="cb21-13"><a href="./#cb21-13"></a><span class="ot">getTags ::</span> <span class="dt">MonadMetadata</span> m <span class="ot">=&gt;</span> <span class="dt">Identifier</span> <span class="ot">-&gt;</span> m [<span class="dt">String</span>]</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb22-1"><a href="./#cb22-1"></a>hakyll <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb22-2"><a href="./#cb22-2"></a></span>
<span id="cb22-3"><a href="./#cb22-3"></a>   tags <span class="ot">&lt;-</span> buildTags visiblePattern (fromCapture <span class="st">&quot;tags/*/index.html&quot;</span>)</span>
<span id="cb22-4"><a href="./#cb22-4"></a></span>
<span id="cb22-5"><a href="./#cb22-5"></a>   <span class="co">-- index</span></span>
<span id="cb22-6"><a href="./#cb22-6"></a>   create [<span class="st">&quot;index.html&quot;</span>] <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb22-7"><a href="./#cb22-7"></a>      route   <span class="op">$</span> idRoute</span>
<span id="cb22-8"><a href="./#cb22-8"></a>      compile <span class="op">$</span> makeItem <span class="st">&quot;&quot;</span></span>
<span id="cb22-9"><a href="./#cb22-9"></a>         <span class="co">-- tags passed to blogCtx</span></span>
<span id="cb22-10"><a href="./#cb22-10"></a>         <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/blog-list.html&quot;</span> (blogCtx <span class="dv">1</span> pages categories tags)</span>
<span id="cb22-11"><a href="./#cb22-11"></a>         <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> defaultCtx </span>
<span id="cb22-12"><a href="./#cb22-12"></a>         <span class="op">&gt;&gt;=</span> indexCompiler</span>
<span id="cb22-13"><a href="./#cb22-13"></a>         <span class="op">&gt;&gt;=</span> relativizeUrls</span>
<span id="cb22-14"><a href="./#cb22-14"></a></span>
<span id="cb22-15"><a href="./#cb22-15"></a>      tagsRules tags <span class="op">$</span> \tag <span class="kw">pattern</span> <span class="ot">-&gt;</span> <span class="kw">do</span></span>
<span id="cb22-16"><a href="./#cb22-16"></a>         tagPages <span class="ot">&lt;-</span> buildPages <span class="kw">pattern</span> (\i <span class="ot">-&gt;</span> fromCaptures <span class="st">&quot;tags/*/*/index.html&quot;</span> [tag, <span class="fu">show</span> i])</span>
<span id="cb22-17"><a href="./#cb22-17"></a>         route   <span class="op">$</span> idRoute</span>
<span id="cb22-18"><a href="./#cb22-18"></a>         compile <span class="op">$</span> makeItem tag</span>
<span id="cb22-19"><a href="./#cb22-19"></a>            <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/blog-list.html&quot;</span> (blogCtx <span class="dv">1</span> tagPages categories tags)</span>
<span id="cb22-20"><a href="./#cb22-20"></a>            <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> defaultCtx</span>
<span id="cb22-21"><a href="./#cb22-21"></a>            <span class="op">&gt;&gt;=</span> indexCompiler</span>
<span id="cb22-22"><a href="./#cb22-22"></a>            <span class="op">&gt;&gt;=</span> relativizeUrls</span>
<span id="cb22-23"><a href="./#cb22-23"></a>         paginateRules tagPages <span class="op">$</span> \i _ <span class="ot">-&gt;</span> <span class="kw">do</span> <span class="co">-- blog tags pages (i is page within tag)</span></span>
<span id="cb22-24"><a href="./#cb22-24"></a>            route idRoute</span>
<span id="cb22-25"><a href="./#cb22-25"></a>            compile <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb22-26"><a href="./#cb22-26"></a>               makeItem tag</span>
<span id="cb22-27"><a href="./#cb22-27"></a>                  <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/blog-list.html&quot;</span> (blogCtx i tagPages categories tags)</span>
<span id="cb22-28"><a href="./#cb22-28"></a>                  <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> defaultCtx</span>
<span id="cb22-29"><a href="./#cb22-29"></a>                  <span class="op">&gt;&gt;=</span> indexCompiler</span>
<span id="cb22-30"><a href="./#cb22-30"></a>                  <span class="op">&gt;&gt;=</span> relativizeUrls</span>
<span id="cb22-31"><a href="./#cb22-31"></a></span>
<span id="cb22-32"><a href="./#cb22-32"></a><span class="ot">blogDetailCtx ::</span> <span class="dt">Tags</span> <span class="ot">-&gt;</span> <span class="dt">Tags</span> <span class="ot">-&gt;</span> <span class="dt">Context</span> <span class="dt">String</span></span>
<span id="cb22-33"><a href="./#cb22-33"></a>blogDetailCtx categories tags <span class="ot">=</span> </span>
<span id="cb22-34"><a href="./#cb22-34"></a>   dateField <span class="st">&quot;date&quot;</span> <span class="st">&quot;%B %e, %Y&quot;</span>                 <span class="op">&lt;&gt;</span></span>
<span id="cb22-35"><a href="./#cb22-35"></a>   mapContext dropFileName (urlField <span class="st">&quot;url&quot;</span>)     <span class="op">&lt;&gt;</span></span>
<span id="cb22-36"><a href="./#cb22-36"></a>   categoryField' <span class="st">&quot;category&quot;</span> categories         <span class="op">&lt;&gt;</span></span>
<span id="cb22-37"><a href="./#cb22-37"></a>   tagsField' <span class="st">&quot;tags&quot;</span> tags                       <span class="op">&lt;&gt;</span> <span class="co">-- tags to context</span></span>
<span id="cb22-38"><a href="./#cb22-38"></a>   field <span class="st">&quot;pages.next.url&quot;</span> nextBlog              <span class="op">&lt;&gt;</span></span>
<span id="cb22-39"><a href="./#cb22-39"></a>   field <span class="st">&quot;pages.previous.url&quot;</span> previousBlog      <span class="op">&lt;&gt;</span></span>
<span id="cb22-40"><a href="./#cb22-40"></a>   summaryField <span class="st">&quot;summary&quot;</span>                       <span class="op">&lt;&gt;</span></span>
<span id="cb22-41"><a href="./#cb22-41"></a>   teaserField  <span class="st">&quot;summary&quot;</span> blogSnapshot          <span class="op">&lt;&gt;</span> </span>
<span id="cb22-42"><a href="./#cb22-42"></a>   previewField <span class="st">&quot;summary&quot;</span> blogSnapshot          <span class="op">&lt;&gt;</span> </span>
<span id="cb22-43"><a href="./#cb22-43"></a>   readingTimeField <span class="st">&quot;reading.time&quot;</span> blogSnapshot <span class="op">&lt;&gt;</span></span>
<span id="cb22-44"><a href="./#cb22-44"></a>   defaultCtx</span></code></pre></div>
<p>Tags can be rendered in a standard way using <code>renderTags</code>, as a tag cloud using <code>renderTagCloud</code> or in a custom way using <code>tagsFieldWith</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb23-1"><a href="./#cb23-1"></a><span class="ot">tagsField' ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Tags</span> <span class="ot">-&gt;</span> <span class="dt">Context</span> a </span>
<span id="cb23-2"><a href="./#cb23-2"></a>tagsField' <span class="ot">=</span> </span>
<span id="cb23-3"><a href="./#cb23-3"></a>   tagsFieldWith getTags (renderLink <span class="st">&quot;#&quot;</span>) (<span class="fu">mconcat</span> <span class="op">.</span> intersperse <span class="st">&quot; &quot;</span>)</span>
<span id="cb23-4"><a href="./#cb23-4"></a></span>
<span id="cb23-5"><a href="./#cb23-5"></a><span class="ot">renderLink ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> (<span class="dt">Maybe</span> <span class="dt">FilePath</span>) <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">H.Html</span></span>
<span id="cb23-6"><a href="./#cb23-6"></a>renderLink _ _   <span class="dt">Nothing</span>       <span class="ot">=</span> <span class="dt">Nothing</span></span>
<span id="cb23-7"><a href="./#cb23-7"></a>renderLink pre text (<span class="dt">Just</span> url) <span class="ot">=</span></span>
<span id="cb23-8"><a href="./#cb23-8"></a>   <span class="dt">Just</span> <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb23-9"><a href="./#cb23-9"></a>      toHtml pre</span>
<span id="cb23-10"><a href="./#cb23-10"></a>      H.a <span class="op">!</span> href (toValue <span class="op">$</span> toUrl url) <span class="op">$</span> toHtml text</span></code></pre></div>
<h1 id="rolling-your-own"><span class="header-section-number">4</span> Rolling your own</h1>
<h2 id="collecting-rules-in-the-rules-monad"><span class="header-section-number">4.1</span> Collecting rules in the Rules monad</h2>
<p>The compiler rules live inside the <code>Rules</code> monad which is an instance of the <code>MonadMetadata</code> type class which enables monads to retrive the <code>Metadata</code> of the source file identified by the <code>Identifier</code>. <code>Metadata</code> is a wrapper around a YAML object with <a href="https://www.stackage.org/haddock/lts-16.10/hakyll-4.13.4.0/Hakyll-Core-Metadata.html">functions</a> to lookup it’s values as either strings or lists of strings.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb24-1"><a href="./#cb24-1"></a><span class="kw">data</span> <span class="dt">Rules</span> a</span>
<span id="cb24-2"><a href="./#cb24-2"></a></span>
<span id="cb24-3"><a href="./#cb24-3"></a><span class="kw">instance</span> <span class="dt">Monad</span> <span class="dt">Rules</span></span>
<span id="cb24-4"><a href="./#cb24-4"></a><span class="kw">instance</span> <span class="dt">Functor</span> <span class="dt">Rules</span></span>
<span id="cb24-5"><a href="./#cb24-5"></a><span class="kw">instance</span> <span class="dt">Applicative</span> <span class="dt">Rules</span></span>
<span id="cb24-6"><a href="./#cb24-6"></a><span class="kw">instance</span> <span class="dt">MonadMetadata</span></span>
<span id="cb24-7"><a href="./#cb24-7"></a></span>
<span id="cb24-8"><a href="./#cb24-8"></a><span class="kw">class</span> <span class="dt">Monad</span> m <span class="ot">=&gt;</span> <span class="dt">MonadMetadata</span> m <span class="kw">where</span></span>
<span id="cb24-9"><a href="./#cb24-9"></a><span class="ot">   getMetadata    ::</span> <span class="dt">Identifier</span> <span class="ot">-&gt;</span> m <span class="dt">Metadata</span></span>
<span id="cb24-10"><a href="./#cb24-10"></a><span class="ot">   getMatches     ::</span> <span class="dt">Pattern</span> <span class="ot">-&gt;</span> m [<span class="dt">Identifier</span>]</span>
<span id="cb24-11"><a href="./#cb24-11"></a></span>
<span id="cb24-12"><a href="./#cb24-12"></a><span class="co">-- getAllMetadata returns all metadata associated with a pattern</span></span>
<span id="cb24-13"><a href="./#cb24-13"></a><span class="ot">getAllMetadata ::</span> <span class="dt">MonadMetadata</span> m <span class="ot">=&gt;</span> <span class="dt">Pattern</span> <span class="ot">-&gt;</span> m [(<span class="dt">Identifier</span>, <span class="dt">Metadata</span>)]</span>
<span id="cb24-14"><a href="./#cb24-14"></a></span>
<span id="cb24-15"><a href="./#cb24-15"></a><span class="co">-- getItemUTC tries to extract and parse the time from the published field </span></span>
<span id="cb24-16"><a href="./#cb24-16"></a><span class="co">-- or from the filename. </span></span>
<span id="cb24-17"><a href="./#cb24-17"></a><span class="ot">getItemUTC ::</span> <span class="dt">MonadMetadata</span> m	<span class="ot">=&gt;</span> <span class="dt">TimeLocale</span>	<span class="ot">-&gt;</span> <span class="dt">Identifier</span>	<span class="ot">-&gt;</span> m <span class="dt">UTCTime</span>	</span>
<span id="cb24-18"><a href="./#cb24-18"></a></span>
<span id="cb24-19"><a href="./#cb24-19"></a><span class="co">-- match matches a pattern and adds a rule for it.</span></span>
<span id="cb24-20"><a href="./#cb24-20"></a><span class="ot">match ::</span> <span class="dt">Pattern</span> <span class="ot">-&gt;</span> <span class="dt">Rules</span> () <span class="ot">-&gt;</span> <span class="dt">Rules</span> ()</span>
<span id="cb24-21"><a href="./#cb24-21"></a></span>
<span id="cb24-22"><a href="./#cb24-22"></a><span class="co">-- hakyll runs the rules in the IO monad</span></span>
<span id="cb24-23"><a href="./#cb24-23"></a><span class="ot">hakyll ::</span> <span class="dt">Rules</span> a <span class="ot">-&gt;</span> <span class="dt">IO</span> ()</span></code></pre></div>
<h2 id="identifiers-and-patterns"><span class="header-section-number">4.2</span> Identifiers and patterns</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb25-1"><a href="./#cb25-1"></a><span class="kw">data</span> <span class="dt">Item</span> a <span class="ot">=</span> <span class="dt">Item</span></span>
<span id="cb25-2"><a href="./#cb25-2"></a>   {<span class="ot"> itemIdentifier ::</span> <span class="dt">Identifier</span></span>
<span id="cb25-3"><a href="./#cb25-3"></a>   ,<span class="ot"> itemBody       ::</span> a</span>
<span id="cb25-4"><a href="./#cb25-4"></a>   } <span class="kw">deriving</span> (<span class="dt">Show</span>, <span class="dt">Typeable</span>)</span>
<span id="cb25-5"><a href="./#cb25-5"></a></span>
<span id="cb25-6"><a href="./#cb25-6"></a><span class="kw">instance</span> <span class="dt">Item</span></span>
<span id="cb25-7"><a href="./#cb25-7"></a><span class="kw">instance</span> <span class="dt">Item</span></span>
<span id="cb25-8"><a href="./#cb25-8"></a><span class="kw">instance</span> <span class="dt">Item</span></span>
<span id="cb25-9"><a href="./#cb25-9"></a><span class="kw">instance</span> <span class="dt">Show</span> a <span class="ot">=&gt;</span> <span class="dt">Show</span> (<span class="dt">Item</span> a)</span>
<span id="cb25-10"><a href="./#cb25-10"></a><span class="kw">instance</span> <span class="dt">Binary</span> a <span class="ot">=&gt;</span> <span class="dt">Binary</span> (<span class="dt">Item</span> a)</span></code></pre></div>
<h2 id="writing-compilers-and-loading-items"><span class="header-section-number">4.3</span> Writing Compilers and loading Items</h2>
<p>The other monad to implement the <code>MonadMetadata</code> type class is the <code>Compiler</code> monad which as the name implies compiles matched source files and takes care of dependencies between rules such that if one rule relies on the results of another rule they are executed in the correct order. The <code>Compiler</code> monad is an instance of <code>Alternative</code> which makes it easy to combine potentially failing compilers (using <code>empty</code>, <code>fail</code>, or <code>throwError</code>) compilers which are tried in sequence until one of them succeeds or else the combined compiler fails.</p>
<p><code>Compiler a</code> values have access to a range of functions which can retrieve the identifier, the source and path of both the matched file and any file identified by an <code>Identifier</code>. Keep in mind that for such function to succeed there needs to exist a rule for that <code>Identifier</code> in the <code>Rules</code> monad. Otherwise Hakyll doesn’t have any knowledge of its existence.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb26-1"><a href="./#cb26-1"></a><span class="kw">data</span> <span class="dt">Compiler</span> a <span class="co">-- a is the the type of the output - usually String</span></span>
<span id="cb26-2"><a href="./#cb26-2"></a></span>
<span id="cb26-3"><a href="./#cb26-3"></a><span class="kw">instance</span> <span class="dt">Monad</span> <span class="dt">Compiler</span></span>
<span id="cb26-4"><a href="./#cb26-4"></a><span class="kw">instance</span> <span class="dt">Functor</span> <span class="dt">Compiler</span></span>
<span id="cb26-5"><a href="./#cb26-5"></a><span class="kw">instance</span> <span class="dt">Applicative</span> <span class="dt">Compiler</span></span>
<span id="cb26-6"><a href="./#cb26-6"></a><span class="kw">instance</span> <span class="dt">Alternative</span> <span class="dt">Compiler</span></span>
<span id="cb26-7"><a href="./#cb26-7"></a><span class="kw">instance</span> <span class="dt">MonadMetadata</span> <span class="dt">Compiler</span></span>
<span id="cb26-8"><a href="./#cb26-8"></a><span class="kw">instance</span> <span class="dt">MonadError</span> <span class="dt">Compiler</span></span>
<span id="cb26-9"><a href="./#cb26-9"></a></span>
<span id="cb26-10"><a href="./#cb26-10"></a><span class="co">-- compile adds a compiler to the Rules monad. Note that the Compiler value is Item a</span></span>
<span id="cb26-11"><a href="./#cb26-11"></a><span class="ot">compile ::</span> (<span class="dt">Binary</span> a, <span class="dt">Typeable</span> a, <span class="dt">Writable</span> a) <span class="ot">=&gt;</span> <span class="dt">Compiler</span> (<span class="dt">Item</span> a) <span class="ot">-&gt;</span> <span class="dt">Rules</span> ()</span>
<span id="cb26-12"><a href="./#cb26-12"></a></span>
<span id="cb26-13"><a href="./#cb26-13"></a><span class="co">-- makeItem lifts a value into the the Compiler monad.</span></span>
<span id="cb26-14"><a href="./#cb26-14"></a><span class="ot">makeItem ::</span> a <span class="ot">-&gt;</span> <span class="dt">Compiler</span> (<span class="dt">Item</span> a)</span>
<span id="cb26-15"><a href="./#cb26-15"></a></span>
<span id="cb26-16"><a href="./#cb26-16"></a><span class="co">-- getRoute returns the route for a specified item</span></span>
<span id="cb26-17"><a href="./#cb26-17"></a><span class="ot">getRoute ::</span> <span class="dt">Identifier</span> <span class="ot">-&gt;</span> <span class="dt">Compiler</span> (<span class="dt">Maybe</span> <span class="dt">FilePath</span>)</span>
<span id="cb26-18"><a href="./#cb26-18"></a></span>
<span id="cb26-19"><a href="./#cb26-19"></a><span class="dt">Parser</span> to try to extract <span class="fu">and</span> parse the time from the published field <span class="fu">or</span> from the filename<span class="op">.</span> <span class="dt">See</span> dateField for more information<span class="op">.</span> <span class="dt">Exported</span> for user convenience<span class="op">.</span></span>
<span id="cb26-20"><a href="./#cb26-20"></a></span>
<span id="cb26-21"><a href="./#cb26-21"></a><span class="co">-- getResourceBody returns the full contents of the matched source file</span></span>
<span id="cb26-22"><a href="./#cb26-22"></a><span class="co">-- as a string without metadata preamble.</span></span>
<span id="cb26-23"><a href="./#cb26-23"></a><span class="ot">getResourceBody ::</span> <span class="dt">Compiler</span> (<span class="dt">Item</span> <span class="dt">String</span>)</span>
<span id="cb26-24"><a href="./#cb26-24"></a></span>
<span id="cb26-25"><a href="./#cb26-25"></a><span class="co">-- load an item compiled elsewhere.</span></span>
<span id="cb26-26"><a href="./#cb26-26"></a><span class="ot">load ::</span> (<span class="dt">Binary</span> a, <span class="dt">Typeable</span> a) <span class="ot">=&gt;</span> <span class="dt">Identifier</span> <span class="ot">-&gt;</span> <span class="dt">Compiler</span> (<span class="dt">Item</span> a)</span>
<span id="cb26-27"><a href="./#cb26-27"></a></span>
<span id="cb26-28"><a href="./#cb26-28"></a><span class="co">-- loadAll loads a dynamic list of items.</span></span>
<span id="cb26-29"><a href="./#cb26-29"></a><span class="ot">loadAll ::</span> (<span class="dt">Binary</span> a, <span class="dt">Typeable</span> a) <span class="ot">=&gt;</span> <span class="dt">Pattern</span> <span class="ot">-&gt;</span> <span class="dt">Compiler</span> [<span class="dt">Item</span> a]</span></code></pre></div>
<h2 id="snapshots-to-define-a-pipeline-stage"><span class="header-section-number">4.4</span> Snapshots to define a pipeline stage</h2>
<p>When loading a compiled resource it usually has the base layout templates applied to it making it unusable in dynamic lists. Snapshots are the solution to that problem. During the compiler construction a snapshot of the resource can be saved in middle of the pipeline allowing you to later <code>load</code> that stage of the compiled resource.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb27-1"><a href="./#cb27-1"></a><span class="co">-- blogs</span></span>
<span id="cb27-2"><a href="./#cb27-2"></a>match allPattern <span class="op">$</span> <span class="kw">do</span></span>
<span id="cb27-3"><a href="./#cb27-3"></a>   route   <span class="op">$</span> blogRoute</span>
<span id="cb27-4"><a href="./#cb27-4"></a>   compile <span class="op">$</span> blogCompiler</span>
<span id="cb27-5"><a href="./#cb27-5"></a>      <span class="op">&gt;&gt;=</span> saveSnapshot blogSnapshot <span class="co">-- saving a Snapshot before templates are applied</span></span>
<span id="cb27-6"><a href="./#cb27-6"></a>      <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/blog-detail.html&quot;</span> (blogDetailCtx categories tags)</span>
<span id="cb27-7"><a href="./#cb27-7"></a>      <span class="op">&gt;&gt;=</span> loadAndApplyTemplate <span class="st">&quot;templates/default.html&quot;</span> defaultCtx</span>
<span id="cb27-8"><a href="./#cb27-8"></a>      <span class="op">&gt;&gt;=</span> indexCompiler</span>
<span id="cb27-9"><a href="./#cb27-9"></a>      <span class="op">&gt;&gt;=</span> relativizeUrls</span>
<span id="cb27-10"><a href="./#cb27-10"></a></span>
<span id="cb27-11"><a href="./#cb27-11"></a><span class="ot">loadBlogs ::</span> <span class="dt">Pattern</span> <span class="ot">-&gt;</span> <span class="dt">Compiler</span> [<span class="dt">Item</span> <span class="dt">String</span>]</span>
<span id="cb27-12"><a href="./#cb27-12"></a>loadBlogs <span class="ot">=</span> </span>
<span id="cb27-13"><a href="./#cb27-13"></a>   recentFirst <span class="op">&lt;=&lt;</span> <span class="fu">flip</span> loadAllSnapshots blogSnapshot <span class="co">-- load blog items using a Snapshot</span></span></code></pre></div>
<h2 id="working-with-contexts-and-templates"><span class="header-section-number">4.5</span> Working with contexts and templates</h2>
<p>Contexts define variables which can be accessed and interpolated in a template. There are three ways to define a <code>Context</code>.</p>
<ol type="1">
<li>Use the <code>Context</code> data constructor.</li>
<li>Use field functions, e.g. <code>field</code>, <code>constField</code> or <code>listField</code>.</li>
<li>Derive a new context from another context using <code>mapContext</code>.</li>
</ol>
<div class="sourceCode" id="cb28"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb28-1"><a href="./#cb28-1"></a><span class="kw">data</span> <span class="dt">ContextField</span></span>
<span id="cb28-2"><a href="./#cb28-2"></a>   <span class="ot">=</span> <span class="dt">StringField</span> <span class="dt">String</span></span>
<span id="cb28-3"><a href="./#cb28-3"></a>   <span class="op">|</span> <span class="kw">forall</span> a<span class="op">.</span> <span class="dt">ListField</span> (<span class="dt">Context</span> a) [<span class="dt">Item</span> a]</span>
<span id="cb28-4"><a href="./#cb28-4"></a></span>
<span id="cb28-5"><a href="./#cb28-5"></a><span class="co">-- Context data constructor wraps a function which takes a key (variable name), </span></span>
<span id="cb28-6"><a href="./#cb28-6"></a><span class="co">-- a list of arguments (for function fields), an item and returns a ContextField</span></span>
<span id="cb28-7"><a href="./#cb28-7"></a><span class="co">-- in the Compiler monad</span></span>
<span id="cb28-8"><a href="./#cb28-8"></a><span class="kw">newtype</span> <span class="dt">Context</span> a <span class="ot">=</span> <span class="dt">Context</span></span>
<span id="cb28-9"><a href="./#cb28-9"></a>   {<span class="ot"> unContext ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> [<span class="dt">String</span>] <span class="ot">-&gt;</span> <span class="dt">Item</span> a <span class="ot">-&gt;</span> <span class="dt">Compiler</span> <span class="dt">ContextField</span></span>
<span id="cb28-10"><a href="./#cb28-10"></a>   }</span>
<span id="cb28-11"><a href="./#cb28-11"></a></span>
<span id="cb28-12"><a href="./#cb28-12"></a><span class="kw">instance</span> <span class="dt">Semigroup</span> (<span class="dt">Context</span> a)</span>
<span id="cb28-13"><a href="./#cb28-13"></a><span class="kw">instance</span> <span class="dt">Monoid</span> (<span class="dt">Context</span> a) <span class="kw">where</span></span>
<span id="cb28-14"><a href="./#cb28-14"></a>   <span class="co">-- mempty is basically empty from Alternative</span></span>
<span id="cb28-15"><a href="./#cb28-15"></a>   <span class="fu">mempty</span>                          <span class="ot">=</span> missingField </span>
<span id="cb28-16"><a href="./#cb28-16"></a>   <span class="co">-- mappend is &lt;|&gt; from Alternative</span></span>
<span id="cb28-17"><a href="./#cb28-17"></a>   <span class="fu">mappend</span> (<span class="dt">Context</span> f) (<span class="dt">Context</span> g) <span class="ot">=</span> <span class="dt">Context</span> <span class="op">$</span> \k a i <span class="ot">-&gt;</span> f k a i <span class="op">&lt;|&gt;</span> g k a i </span>
<span id="cb28-18"><a href="./#cb28-18"></a></span>
<span id="cb28-19"><a href="./#cb28-19"></a><span class="co">-- field takes a key and a function that constructs a value based on the item </span></span>
<span id="cb28-20"><a href="./#cb28-20"></a><span class="co">-- (e.g. accessing metadata) and returns a new context.</span></span>
<span id="cb28-21"><a href="./#cb28-21"></a><span class="ot">field ::</span> <span class="dt">String</span>	<span class="ot">-&gt;</span> (<span class="dt">Item</span> a <span class="ot">-&gt;</span> <span class="dt">Compiler</span> <span class="dt">String</span>)<span class="ot">-&gt;</span> <span class="dt">Context</span> a	 </span>
<span id="cb28-22"><a href="./#cb28-22"></a></span>
<span id="cb28-23"><a href="./#cb28-23"></a><span class="co">-- constField takes a key and a constant value and returns a context</span></span>
<span id="cb28-24"><a href="./#cb28-24"></a><span class="ot">constField ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Context</span> a</span>
<span id="cb28-25"><a href="./#cb28-25"></a></span>
<span id="cb28-26"><a href="./#cb28-26"></a><span class="co">-- listField takes a string, a context to be applied inside a </span></span>
<span id="cb28-27"><a href="./#cb28-27"></a><span class="co">-- $for(..)$ expression, and the items to iterate over.</span></span>
<span id="cb28-28"><a href="./#cb28-28"></a><span class="ot">listField ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Context</span> a <span class="ot">-&gt;</span> <span class="dt">Compiler</span> [<span class="dt">Item</span> a] <span class="ot">-&gt;</span> <span class="dt">Context</span> b</span>
<span id="cb28-29"><a href="./#cb28-29"></a></span>
<span id="cb28-30"><a href="./#cb28-30"></a><span class="co">-- mapContext takes a function, a context and returns a new context</span></span>
<span id="cb28-31"><a href="./#cb28-31"></a><span class="co">-- with all field values transformed.</span></span>
<span id="cb28-32"><a href="./#cb28-32"></a><span class="ot">mapContext ::</span> (<span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span>) <span class="ot">-&gt;</span> <span class="dt">Context</span> a <span class="ot">-&gt;</span> <span class="dt">Context</span> a</span></code></pre></div>
<p>The <code>Context</code> data constructor is rarely used but necessary if the the context needs to be able to return <code>mempty</code> which is implimented as a failing <code>Compiler</code>. In the <code>Compiler</code> monad failure can be signalled with <code>empty</code>, <code>noResult</code> or <code>throwError</code>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb29-1"><a href="./#cb29-1"></a><span class="co">-- aliasContext maps a new key to another key. If the other key</span></span>
<span id="cb29-2"><a href="./#cb29-2"></a><span class="co">-- is not defined or returns empty the alias returns empty.</span></span>
<span id="cb29-3"><a href="./#cb29-3"></a><span class="ot">aliasContext ::</span> (<span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">String</span>) <span class="ot">-&gt;</span> <span class="dt">Context</span> a <span class="ot">-&gt;</span> <span class="dt">Context</span> a</span>
<span id="cb29-4"><a href="./#cb29-4"></a>aliasContext f (<span class="dt">Context</span> c) <span class="ot">=</span> </span>
<span id="cb29-5"><a href="./#cb29-5"></a>   <span class="dt">Context</span> <span class="op">$</span> \k a i <span class="ot">-&gt;</span> c (f k) a i <span class="op">&lt;|&gt;</span> c' k <span class="co">-- Compiler implements Alternative</span></span>
<span id="cb29-6"><a href="./#cb29-6"></a>   <span class="kw">where</span> </span>
<span id="cb29-7"><a href="./#cb29-7"></a>      c' k <span class="ot">=</span> noResult <span class="op">$</span> <span class="fu">unwords</span> [<span class="st">&quot;Tried to alias&quot;</span>, k, <span class="st">&quot;as&quot;</span>, f k, <span class="st">&quot;which doesn't exist&quot;</span>]</span>
<span id="cb29-8"><a href="./#cb29-8"></a></span>
<span id="cb29-9"><a href="./#cb29-9"></a><span class="ot">readingTimeField ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Snapshot</span> <span class="ot">-&gt;</span> <span class="dt">Context</span> <span class="dt">String</span></span>
<span id="cb29-10"><a href="./#cb29-10"></a>readingTimeField key snapshot <span class="ot">=</span> </span>
<span id="cb29-11"><a href="./#cb29-11"></a>   field key calculate <span class="co">-- calculate :: Item String -&gt; Compiler String</span></span>
<span id="cb29-12"><a href="./#cb29-12"></a>   <span class="kw">where</span></span>
<span id="cb29-13"><a href="./#cb29-13"></a>      calculate item <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb29-14"><a href="./#cb29-14"></a>         body <span class="ot">&lt;-</span> loadSnapshotBody (itemIdentifier item) snapshot</span>
<span id="cb29-15"><a href="./#cb29-15"></a>         <span class="fu">return</span> <span class="op">$</span> withTagList acc body</span>
<span id="cb29-16"><a href="./#cb29-16"></a>      acc ts <span class="ot">=</span> [<span class="dt">TagText</span> (<span class="fu">show</span> (time ts))]</span>
<span id="cb29-17"><a href="./#cb29-17"></a>      time ts <span class="ot">=</span> foldl' count <span class="dv">0</span>  ts <span class="ot">`div`</span> <span class="dv">265</span></span>
<span id="cb29-18"><a href="./#cb29-18"></a>      count n (<span class="dt">TagText</span> s) <span class="ot">=</span> n <span class="op">+</span> <span class="fu">length</span> (<span class="fu">words</span> s)</span>
<span id="cb29-19"><a href="./#cb29-19"></a>      count n _           <span class="ot">=</span> n</span>
<span id="cb29-20"><a href="./#cb29-20"></a></span>
<span id="cb29-21"><a href="./#cb29-21"></a><span class="ot">decksDetailCtx ::</span> <span class="dt">Context</span> <span class="dt">String</span></span>
<span id="cb29-22"><a href="./#cb29-22"></a>decksDetailCtx <span class="ot">=</span> </span>
<span id="cb29-23"><a href="./#cb29-23"></a>   dateField <span class="st">&quot;date&quot;</span> <span class="st">&quot;%B %e, %Y&quot;</span>             <span class="op">&lt;&gt;</span></span>
<span id="cb29-24"><a href="./#cb29-24"></a>   mapContext dropFileName (urlField <span class="st">&quot;url&quot;</span>) <span class="op">&lt;&gt;</span> <span class="co">-- drops the file name from the urlField</span></span>
<span id="cb29-25"><a href="./#cb29-25"></a>   defaultCtx                               <span class="op">&lt;&gt;</span></span>
<span id="cb29-26"><a href="./#cb29-26"></a>   constField <span class="st">&quot;theme&quot;</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb29-27"><a href="./#cb29-27"></a></span>
<span id="cb29-28"><a href="./#cb29-28"></a><span class="co">-- fail with an error message</span></span>
<span id="cb29-29"><a href="./#cb29-29"></a><span class="ot">noResult ::</span> <span class="dt">String</span> <span class="ot">-&gt;</span> <span class="dt">Compiler</span> a</span>
<span id="cb29-30"><a href="./#cb29-30"></a></span>
<span id="cb29-31"><a href="./#cb29-31"></a><span class="co">-- empty is the identity of &lt;|&gt;</span></span>
<span id="cb29-32"><a href="./#cb29-32"></a><span class="ot">empty ::</span> <span class="dt">Alternative</span> f <span class="ot">=&gt;</span> f a</span>
<span id="cb29-33"><a href="./#cb29-33"></a></span>
<span id="cb29-34"><a href="./#cb29-34"></a><span class="co">-- throwError used within a monadic computation begins exception processing</span></span>
<span id="cb29-35"><a href="./#cb29-35"></a><span class="ot">throwError ::</span> <span class="dt">Monad</span> m, <span class="dt">MonadError</span> e m <span class="op">|</span> m <span class="ot">-&gt;</span> e <span class="ot">=&gt;</span> e <span class="ot">-&gt;</span> m a</span></code></pre></div>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>DSL stands for Domain Specific Language. Hakyll is an eDSL, embedded Domain Specific Language, which means that the DSL is defined in the underlying programming languages code as opposed to a completely new language.<a href="./#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>
    </section>

    <section>
        <p>
            @<a href="../../../code/">code</a> 
            #<a href="../../../tags/haskell/">haskell</a> 
        </p>
        <p>
        </p>
    </section>

    <footer>
        <nav class="c-pagination p-pagination">
            <div class="c-pagination__ctrl">
                <div class="c-pagination__newer">
                    <a href="../../../2020/08/a-bref-history-of-ethereum/">Newer</a>
                    
                </div>
                <div class="c-pagination__older">
                    <a href="../../../2014/10/receiving-bitcoins/">Older</a>
                    
                </div>
            </div>
        </nav>
    </footer>

</article>

        </main>
     
        <footer class="l-footer">
            <p class="p-copyright">
                Copyright <i class="fas fa-heart" style="color: red;"></i> Gísli Kristjánsson 2020
            </p>
        </footer>

        <link rel="stylesheet" href="../../../katex/katex.min.css">
        <script defer src="../../../katex/katex.min.js"></script>
        <script type="text/javascript" script defer src="../../../katex/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    </body>
</html>
            
